#!/bin/bash
set -eo pipefail
source_dir=$(cd -- "$(dirname -- "$0")" && pwd)
. "$source_dir/../qquser-check"

read -r -p "Push dotfile updates to GitHub? (y/N) " github_answer
read -r -p "Sync files with home-server? (y/N) " server_sync_answer
read -r -p "Do you want to delete ~/.wine? (y/N) " wine_answer
read -r -p "Do you want to eject devices after backup? (y/N) " eject_answer

if [ "${github_answer,,}" = "y" ]; then
	"$source_dir/qqdotfiles" git commit
	"$source_dir/qqdotfiles" git push
fi


"$source_dir/qqmount" ext1
"$source_dir/qqmount" ext2
"$source_dir/qqmount" part

if [ "${server_sync_answer,,}" = "y" ]; then
	"$source_dir/qqnfs" -mount home-server
	"$source_dir/qqdotfiles" home-server-sync
fi

if [ "${wine_answer,,}" = "y" ]; then
	"$source_dir/qqclean" -delete-wine
else
	"$source_dir/qqclean"
fi

sudo "$source_dir/../qqsudo" luckybackup -c --no-questions default
sudo "$source_dir/../qqsudo" luckybackup -c --no-questions ext2-sync

if [ "${eject_answer,,}" = "y" ]; then
	"$source_dir/qqmount" -u ext1
	"$source_dir/qqmount" -u ext2
	"$source_dir/qqmount" -u part
	"$source_dir/qqnfs" -umount home-server
fi

echo "Done backing up"
