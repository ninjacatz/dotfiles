#!/bin/bash
set -euo pipefail
source_dir=$(cd -- "$(dirname -- "$0")" && pwd)
. "$source_dir/../qquser-check"

read -p "Push dotfile updates to GitHub? (y/N) " github_answer

if [ "{$github_answer,,}" = "y" ]; then
	"$source_dir/qqdotfiles" commit
	"$source_dir/qqdotfiles" push
fi

"$source_dir/qqmount" ext1
"$source_dir/qqmount" ext2
"$source_dir/qqmount" part

"$source_dir/qqclean"

sudo "$source_dir/../qqsudo" luckybackup -c --no-questions default
sudo "$source_dir/../qqsudo" luckybackup -c --no-questions ext2-sync

echo ""
read -p "Do you want to eject devices? (y/N) " eject_answer

if [ "{$eject_answer,,}" = "y" ]; then
	"$source_dir/qqmount" -u ext1
	"$source_dir/qqmount" -u ext2
	"$source_dir/qqmount" -u part
fi

echo "Done backing up"
