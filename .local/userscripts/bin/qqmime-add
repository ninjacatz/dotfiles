#!/bin/bash
set -eo pipefail
source_dir=$(cd -- "$(dirname -- "$0")" && pwd)
. "$source_dir/../qquser-check"

usage () {
	cat <<EOF
Usage: ${0##*/}
Options:
	vim|mpv
		file
EOF
}

if ! [ -e "$2" ]; then
	usage
	exit 1
fi

filetype=$(xdg-mime query filetype "$2")

if [ -z "$filetype" ]; then
	echo "Failed to get mime type for $2"
	exit 1
fi

if grep -q "^$filetype=" "$HOME/.config/mimeapps.list"; then
	echo "$filetype already in ~/.config/mimeapps.list"
	exit 1
fi

case "$1" in
	vim|mpv)
		new_line="$filetype=$1.desktop"
		;;
	*)
		usage
		exit 1
		;;
esac

echo "$new_line" >> ~/.config/mimeapps.list

