#!/bin/bash
set -eo pipefail
source_dir=$(cd -- "$(dirname -- "$0")" && pwd)
. "$source_dir/../qquser-check"

usage () {
	cat <<EOF
Usage: ${0##*/}
Options:
	-internal|-external|-external-1080p|-parents
EOF
	exit 1
}

old_monitor=$(xrandr | awk '/ connected/ && /[[:digit:]]x[[:digit:]].*+/{print $1}')

case "$1" in
	-internal)
		new_monitor="LVDS-1"
		xrandr \
		--output "$new_monitor" --primary --mode 1920x1080 --rate 60.00
		"$source_dir/qqvolume" -output -default
		;;
	-external)
		new_monitor="DP-1"
		xrandr \
		--output "$new_monitor" --primary --mode 2560x1440 --rate 75.00
		"$source_dir/qqvolume" -output -displayport
		;;
	-external-1080p)
		new_monitor="DP-1"
		xrandr \
		--output "$new_monitor" --primary --mode 1920x1080 --rate 120.00
		"$source_dir/qqvolume" -output -displayport
		;;
	-parents)
		new_monitor="HDMI-1"
		xrandr \
		--output "$new_monitor" --primary --mode 1920x1080 --pos 0x0 --rotate normal
		"$source_dir/qqvolume" -output -displayport
		;;
	*)
		usage
		exit 1
		;;
esac

if [[ "$old_monitor" != "$new_monitor" ]]; then
    bspc monitor "$old_monitor" -a temp_desktop
	bspc desktop 1 --to-monitor "$new_monitor"
	bspc desktop 2 --to-monitor "$new_monitor"
	bspc desktop 3 --to-monitor "$new_monitor"
	bspc desktop 4 --to-monitor "$new_monitor"
	bspc desktop Desktop -r
	bspc monitor "$old_monitor" -r
	xrandr --output "$old_monitor" --off
	sleep 2
	"$HOME/.config/bspwm/bspwmrc"
fi


