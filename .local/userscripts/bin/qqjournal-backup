#!/bin/bash
source_dir=$(cd -- "$(dirname -- "$0")" && pwd)
. "$source_dir/../qquser-check"

journal_path=/mnt/part/journal
journal_converted_path=$HOME/Downloads/journal-converted
journal_attach_path=$HOME/Downloads
journal_ext1_path=/mnt/ext1/journal
journal_ext2_path=/mnt/ext2/journal

if [ ! -d "$journal_converted_path" ]; then
	echo "Converted journals not found"
	exit 1
fi

read -p "Would you like to trash old journals? ('y' or *) " input

$source_dir/qqmount ext1
$source_dir/qqmount ext2
$source_dir/qqmount part

# Append the contents of the converted journals to the journals in ext1
rsync -av --ignore-existing "$journal_converted_path/" "$journal_ext1_path/"

# Sync ext1 and ext2 via luckybackup
sudo $source_dir/../qqsudo luckybackup -c --no-questions ext2-sync

echo "Done backing up"

if [ "$input" = "y" ]; then
	trash $journal_path/*
	trash $journal_converted_path
	echo "Old journals trashed"
fi

read -p "Do you want to eject devices? ('y' or *) " answer

if [ "$answer" = "y" ]; then
	$source_dir/qqmount -u ext1
	$source_dir/qqmount -u ext2
	$source_dir/qqmount -u part
fi

echo "Done backing up"
