#!/bin/bash
set -eo pipefail
source_dir=$(cd -- "$(dirname -- "$0")" && pwd)
. "$source_dir/../qquser-check"

# if no arguments supplied
if [ "$#" -eq 0 ]; then
	read -r -p "Do you want to delete ~/.wine? (y/N) " wine_answer
fi

if [[ "${wine_answer,,}" = "y" || "$1" = "-delete-wine" ]]; then
	rm -rf "$HOME"/.wine
	rm -rf "$HOME"/.local/share/applications/wine
	sudo "$source_dir/../qqsudo" rm -rf /root/.wine
fi

echo "Running bleachbit"
bleachbit -c --preset &>/dev/null
echo "Running bleachbit root"
sudo "$source_dir/../qqsudo" bleachbit -c --preset &>/dev/null

# bash
rm -f "$HOME/.bash_history"
sudo "$source_dir/../qqsudo" rm -f "/root/.bash_history"
# vim
rm -f "$HOME/.vim/viminfo"
rm -f "$HOME/.vim/.netrwhist"
# vifm
rm -f "$HOME/.config/vifm/vifminfo.json"
# iwctl
rm -f "$HOME/.config/iwctl/history"
# other home directory
rm -f "$HOME/.lesshst"
sudo "$source_dir/../qqsudo" rm -f "/root/.lesshst"
rm -f "$HOME/.wget-hsts"
sudo "$source_dir/../qqsudo" rm -f "/root/.wget-hsts"
# ssh
# rm -f "$HOME/.ssh/known_hosts"*
# X session errors
rm -f "$HOME/.xsession-errors"
# zathura
rm -f "$HOME/.local/share/zathura/"*
# cache
rm -rf "$HOME/.cache"
sudo "$source_dir/../qqsudo" rm -rf "/root/.cache"
# GIMP recent files (and others)
rm -f "$HOME/.local/share/recently-used.xbel"
# MPV saved video locations
rm -f "$HOME/.config/mpv/watch_later/"*
# Audacity recent files
sed -i '/^file/d' "$HOME/.config/audacity/audacity.cfg" || true
# OpenOffice recent files
sed -i "/^<item oor:path=\"\/org.openoffice.Office.Histories/d" "$HOME/.config/libreoffice/4/user/registrymodifications.xcu" || true

echo "Done cleaning"
