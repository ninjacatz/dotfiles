#!/bin/bash
source_dir=$(cd -- "$(dirname -- "$0")" && pwd)
. "$source_dir/../qquser-check"

read -p "Do you want to push dotfile updates to GitHub? ('y' or *) " github_answer

if [ "$github_answer" = "y" ]; then
	$source_dir/qqdotfiles commit
	$source_dir/qqdotfiles push
fi

# -------------------------------
# decrypt and mount devices

$source_dir/qqmount ext1
$source_dir/qqmount ext2
$source_dir/qqmount part

# -------------------------------
# clear as much data + history as possible

$source_dir/qqclean

# -----------------------------
# finally backup data

sudo $source_dir/../qqsudo luckybackup -c --no-questions default
sudo $source_dir/../qqsudo luckybackup -c --no-questions ext2-sync

# -----------------------------
# eject devices

echo ""
read -p "Do you want to eject devices? ('y' or *) " answer

if [ "$answer" = "y" ]; then
	$source_dir/qqmount -u ext1
	$source_dir/qqmount -u ext2
	$source_dir/qqmount -u part
fi

echo "Done backing up"





